{"version":3,"file":"Control.Geocoder.min.js","sources":["../src/util.js","../src/geocoders/nominatim.js","../src/control.js","../src/geocoders/here.js","../src/index.js"],"sourcesContent":["import L from 'leaflet';\nvar lastCallbackId = 0;\n\n// Adapted from handlebars.js\n// https://github.com/wycats/handlebars.js/\nvar badChars = /[&<>\"'`]/g;\nvar possible = /[&<>\"'`]/;\nvar escape = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#x27;',\n  '`': '&#x60;'\n};\n\nfunction escapeChar(chr) {\n  return escape[chr];\n}\n\nexport function htmlEscape(string) {\n  if (string == null) {\n    return '';\n  } else if (!string) {\n    return string + '';\n  }\n\n  // Force a string conversion as this will be done by the append regardless and\n  // the regex test will do this transparently behind the scenes, causing issues if\n  // an object's to string has escaped characters in it.\n  string = '' + string;\n\n  if (!possible.test(string)) {\n    return string;\n  }\n  return string.replace(badChars, escapeChar);\n}\n\nexport function jsonp(url, params, callback, context, jsonpParam) {\n  var callbackId = '_l_geocoder_' + lastCallbackId++;\n  params[jsonpParam || 'callback'] = callbackId;\n  window[callbackId] = L.Util.bind(callback, context);\n  var script = document.createElement('script');\n  script.type = 'text/javascript';\n  script.src = url + getParamString(params);\n  script.id = callbackId;\n  document.getElementsByTagName('head')[0].appendChild(script);\n}\n\nexport function getJSON(url, params, callback) {\n  var xmlHttp = new XMLHttpRequest();\n  xmlHttp.onreadystatechange = function() {\n    if (xmlHttp.readyState !== 4) {\n      return;\n    }\n    if (xmlHttp.status !== 200 && xmlHttp.status !== 304) {\n      callback('');\n      return;\n    }\n    callback(JSON.parse(xmlHttp.response));\n  };\n  xmlHttp.open('GET', url + getParamString(params), true);\n  xmlHttp.setRequestHeader('Accept', 'application/json');\n  xmlHttp.send(null);\n}\n\nexport function template(str, data) {\n  return str.replace(/\\{ *([\\w_]+) *\\}/g, function(str, key) {\n    var value = data[key];\n    if (value === undefined) {\n      value = '';\n    } else if (typeof value === 'function') {\n      value = value(data);\n    }\n    return htmlEscape(value);\n  });\n}\n\nexport function getParamString(obj, existingUrl, uppercase) {\n  var params = [];\n  for (var i in obj) {\n    var key = encodeURIComponent(uppercase ? i.toUpperCase() : i);\n    var value = obj[i];\n    if (!L.Util.isArray(value)) {\n      params.push(key + '=' + encodeURIComponent(value));\n    } else {\n      for (var j = 0; j < value.length; j++) {\n        params.push(key + '=' + encodeURIComponent(value[j]));\n      }\n    }\n  }\n  return (!existingUrl || existingUrl.indexOf('?') === -1 ? '?' : '&') + params.join('&');\n}\n","import L from 'leaflet';\nimport { template, getJSON } from '../util';\n\nexport default {\n  class: L.Class.extend({\n    options: {\n      serviceUrl: 'https://nominatim.openstreetmap.org/',\n      geocodingQueryParams: {},\n      reverseQueryParams: {},\n      htmlTemplate: function(r) {\n        var a = r.address,\n          parts = [];\n        if (a.road || a.building) {\n          parts.push('{building} {road} {house_number}');\n        }\n\n        if (a.city || a.town || a.village || a.hamlet) {\n          parts.push(\n            '<span class=\"' +\n              (parts.length > 0 ? 'leaflet-control-geocoder-address-detail' : '') +\n              '\">{postcode} {city} {town} {village} {hamlet}</span>'\n          );\n        }\n\n        if (a.state || a.country) {\n          parts.push(\n            '<span class=\"' +\n              (parts.length > 0 ? 'leaflet-control-geocoder-address-context' : '') +\n              '\">{state} {country}</span>'\n          );\n        }\n\n        return template(parts.join('<br/>'), a, true);\n      }\n    },\n\n    initialize: function(options) {\n      L.Util.setOptions(this, options);\n    },\n\n    geocode: function(query, cb, context) {\n      getJSON(\n        this.options.serviceUrl + 'search',\n        L.extend(\n          {\n            q: query,\n            limit: 5,\n            format: 'json',\n            addressdetails: 1\n          },\n          this.options.geocodingQueryParams\n        ),\n        L.bind(function(data) {\n          var results = [];\n          for (var i = data.length - 1; i >= 0; i--) {\n            var bbox = data[i].boundingbox;\n            for (var j = 0; j < 4; j++) bbox[j] = parseFloat(bbox[j]);\n            results[i] = {\n              icon: data[i].icon,\n              name: data[i].display_name,\n              html: this.options.htmlTemplate ? this.options.htmlTemplate(data[i]) : undefined,\n              bbox: L.latLngBounds([bbox[0], bbox[2]], [bbox[1], bbox[3]]),\n              center: L.latLng(data[i].lat, data[i].lon),\n              properties: data[i]\n            };\n          }\n          cb.call(context, results);\n        }, this)\n      );\n    },\n\n    reverse: function(location, scale, cb, context) {\n      getJSON(\n        this.options.serviceUrl + 'reverse',\n        L.extend(\n          {\n            lat: location.lat,\n            lon: location.lng,\n            zoom: Math.round(Math.log(scale / 256) / Math.log(2)),\n            addressdetails: 1,\n            format: 'json'\n          },\n          this.options.reverseQueryParams\n        ),\n        L.bind(function(data) {\n          var result = [],\n            loc;\n\n          if (data && data.lat && data.lon) {\n            loc = L.latLng(data.lat, data.lon);\n            result.push({\n              name: data.display_name,\n              html: this.options.htmlTemplate ? this.options.htmlTemplate(data) : undefined,\n              center: loc,\n              bounds: L.latLngBounds(loc, loc),\n              properties: data\n            });\n          }\n\n          cb.call(context, result);\n        }, this)\n      );\n    }\n  }),\n\n  factory: function(options) {\n    return new L.Control.Geocoder.Nominatim(options);\n  }\n};\n","import L from 'leaflet';\nimport Nominatim from './geocoders/nominatim';\n\nexport default {\n  class: L.Control.extend({\n    options: {\n      showResultIcons: false,\n      collapsed: true,\n      expand: 'touch', // options: touch, click, anythingelse\n      position: 'topright',\n      placeholder: 'Search...',\n      errorMessage: 'Nothing found.',\n      queryMinLength: 1,\n      suggestMinLength: 3,\n      suggestTimeout: 250,\n      defaultMarkGeocode: true\n    },\n\n    includes: L.Evented.prototype || L.Mixin.Events,\n\n    initialize: function(options) {\n      L.Util.setOptions(this, options);\n      if (!this.options.geocoder) {\n        this.options.geocoder = new Nominatim.class();\n      }\n\n      this._requestCount = 0;\n    },\n\n    onAdd: function(map) {\n      var className = 'leaflet-control-geocoder',\n        container = L.DomUtil.create('div', className + ' leaflet-bar'),\n        icon = L.DomUtil.create('button', className + '-icon', container),\n        form = (this._form = L.DomUtil.create('div', className + '-form', container)),\n        input;\n\n      this._map = map;\n      this._container = container;\n\n      icon.innerHTML = '&nbsp;';\n      icon.type = 'button';\n\n      input = this._input = L.DomUtil.create('input', '', form);\n      input.type = 'text';\n      input.placeholder = this.options.placeholder;\n      L.DomEvent.disableClickPropagation(input);\n\n      this._errorElement = L.DomUtil.create('div', className + '-form-no-error', container);\n      this._errorElement.innerHTML = this.options.errorMessage;\n\n      this._alts = L.DomUtil.create(\n        'ul',\n        className + '-alternatives leaflet-control-geocoder-alternatives-minimized',\n        container\n      );\n      L.DomEvent.disableClickPropagation(this._alts);\n\n      L.DomEvent.addListener(input, 'keydown', this._keydown, this);\n      if (this.options.geocoder.suggest) {\n        L.DomEvent.addListener(input, 'input', this._change, this);\n      }\n      L.DomEvent.addListener(\n        input,\n        'blur',\n        function() {\n          if (this.options.collapsed && !this._preventBlurCollapse) {\n            this._collapse();\n          }\n          this._preventBlurCollapse = false;\n        },\n        this\n      );\n\n      if (this.options.collapsed) {\n        if (this.options.expand === 'click') {\n          L.DomEvent.addListener(\n            container,\n            'click',\n            function(e) {\n              if (e.button === 0 && e.detail !== 2) {\n                this._toggle();\n              }\n            },\n            this\n          );\n        } else if (L.Browser.touch && this.options.expand === 'touch') {\n          L.DomEvent.addListener(\n            container,\n            'touchstart mousedown',\n            function(e) {\n              this._toggle();\n              e.preventDefault(); // mobile: clicking focuses the icon, so UI expands and immediately collapses\n              e.stopPropagation();\n            },\n            this\n          );\n        } else {\n          L.DomEvent.addListener(container, 'mouseover', this._expand, this);\n          L.DomEvent.addListener(container, 'mouseout', this._collapse, this);\n          this._map.on('movestart', this._collapse, this);\n        }\n      } else {\n        this._expand();\n        if (L.Browser.touch) {\n          L.DomEvent.addListener(\n            container,\n            'touchstart',\n            function() {\n              this._geocode();\n            },\n            this\n          );\n        } else {\n          L.DomEvent.addListener(\n            container,\n            'click',\n            function() {\n              this._geocode();\n            },\n            this\n          );\n        }\n      }\n\n      if (this.options.defaultMarkGeocode) {\n        this.on('markgeocode', this.markGeocode, this);\n      }\n\n      this.on(\n        'startgeocode',\n        function() {\n          L.DomUtil.addClass(this._container, 'leaflet-control-geocoder-throbber');\n        },\n        this\n      );\n      this.on(\n        'finishgeocode',\n        function() {\n          L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-throbber');\n        },\n        this\n      );\n\n      L.DomEvent.disableClickPropagation(container);\n\n      return container;\n    },\n\n    _geocodeResult: function(results, suggest) {\n      if (!suggest && results.length === 1) {\n        this._geocodeResultSelected(results[0]);\n      } else if (results.length > 0) {\n        this._alts.innerHTML = '';\n        this._results = results;\n        L.DomUtil.removeClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\n        for (var i = 0; i < results.length; i++) {\n          this._alts.appendChild(this._createAlt(results[i], i));\n        }\n      } else {\n        L.DomUtil.addClass(this._errorElement, 'leaflet-control-geocoder-error');\n      }\n    },\n\n    markGeocode: function(result) {\n      result = result.geocode || result;\n\n      this._map.fitBounds(result.bbox);\n\n      if (this._geocodeMarker) {\n        this._map.removeLayer(this._geocodeMarker);\n      }\n\n      this._geocodeMarker = new L.Marker(result.center)\n        .bindPopup(result.html || result.name)\n        .addTo(this._map)\n        .openPopup();\n\n      return this;\n    },\n\n    _geocode: function(suggest) {\n      var value = this._input.value;\n      if (!suggest && value.length < this.options.queryMinLength) {\n        return;\n      }\n\n      var requestCount = ++this._requestCount,\n        mode = suggest ? 'suggest' : 'geocode',\n        eventData = { input: value };\n\n      this._lastGeocode = value;\n      if (!suggest) {\n        this._clearResults();\n      }\n\n      this.fire('start' + mode, eventData);\n      this.options.geocoder[mode](\n        value,\n        function(results) {\n          if (requestCount === this._requestCount) {\n            eventData.results = results;\n            this.fire('finish' + mode, eventData);\n            this._geocodeResult(results, suggest);\n          }\n        },\n        this\n      );\n    },\n\n    _geocodeResultSelected: function(result) {\n      this.fire('markgeocode', { geocode: result });\n    },\n\n    _toggle: function() {\n      if (L.DomUtil.hasClass(this._container, 'leaflet-control-geocoder-expanded')) {\n        this._collapse();\n      } else {\n        this._expand();\n      }\n    },\n\n    _expand: function() {\n      L.DomUtil.addClass(this._container, 'leaflet-control-geocoder-expanded');\n      this._input.select();\n      this.fire('expand');\n    },\n\n    _collapse: function() {\n      L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-expanded');\n      L.DomUtil.addClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\n      L.DomUtil.removeClass(this._errorElement, 'leaflet-control-geocoder-error');\n      this._input.blur(); // mobile: keyboard shouldn't stay expanded\n      this.fire('collapse');\n    },\n\n    _clearResults: function() {\n      L.DomUtil.addClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\n      this._selection = null;\n      L.DomUtil.removeClass(this._errorElement, 'leaflet-control-geocoder-error');\n    },\n\n    _createAlt: function(result, index) {\n      var li = L.DomUtil.create('li', ''),\n        a = L.DomUtil.create('a', '', li),\n        icon = this.options.showResultIcons && result.icon ? L.DomUtil.create('img', '', a) : null,\n        text = result.html ? undefined : document.createTextNode(result.name),\n        mouseDownHandler = function mouseDownHandler(e) {\n          // In some browsers, a click will fire on the map if the control is\n          // collapsed directly after mousedown. To work around this, we\n          // wait until the click is completed, and _then_ collapse the\n          // control. Messy, but this is the workaround I could come up with\n          // for #142.\n          this._preventBlurCollapse = true;\n          L.DomEvent.stop(e);\n          this._geocodeResultSelected(result);\n          L.DomEvent.on(\n            li,\n            'click',\n            function() {\n              if (this.options.collapsed) {\n                this._collapse();\n              } else {\n                this._clearResults();\n              }\n            },\n            this\n          );\n        };\n\n      if (icon) {\n        icon.src = result.icon;\n      }\n\n      li.setAttribute('data-result-index', index);\n\n      if (result.html) {\n        a.innerHTML = a.innerHTML + result.html;\n      } else {\n        a.appendChild(text);\n      }\n\n      // Use mousedown and not click, since click will fire _after_ blur,\n      // causing the control to have collapsed and removed the items\n      // before the click can fire.\n      L.DomEvent.addListener(li, 'mousedown touchstart', mouseDownHandler, this);\n\n      return li;\n    },\n\n    _keydown: function(e) {\n      var _this = this,\n        select = function select(dir) {\n          if (_this._selection) {\n            L.DomUtil.removeClass(_this._selection, 'leaflet-control-geocoder-selected');\n            _this._selection = _this._selection[dir > 0 ? 'nextSibling' : 'previousSibling'];\n          }\n          if (!_this._selection) {\n            _this._selection = _this._alts[dir > 0 ? 'firstChild' : 'lastChild'];\n          }\n\n          if (_this._selection) {\n            L.DomUtil.addClass(_this._selection, 'leaflet-control-geocoder-selected');\n          }\n        };\n\n      switch (e.keyCode) {\n        // Escape\n        case 27:\n          if (this.options.collapsed) {\n            this._collapse();\n          }\n          break;\n        // Up\n        case 38:\n          select(-1);\n          break;\n        // Up\n        case 40:\n          select(1);\n          break;\n        // Enter\n        case 13:\n          if (this._selection) {\n            var index = parseInt(this._selection.getAttribute('data-result-index'), 10);\n            this._geocodeResultSelected(this._results[index]);\n            this._clearResults();\n          } else {\n            this._geocode();\n          }\n          break;\n        default:\n          return;\n      }\n\n      L.DomEvent.preventDefault(e);\n    },\n    _change: function() {\n      var v = this._input.value;\n      if (v !== this._lastGeocode) {\n        clearTimeout(this._suggestTimeout);\n        if (v.length >= this.options.suggestMinLength) {\n          this._suggestTimeout = setTimeout(\n            L.bind(function() {\n              this._geocode(true);\n            }, this),\n            this.options.suggestTimeout\n          );\n        } else {\n          this._clearResults();\n        }\n      }\n    }\n  }),\n  factory: function(options) {\n    return new L.Control.Geocoder(options);\n  }\n};\n","import L from 'leaflet';\nimport { getJSON } from '../util';\n\nexport default {\n  class: L.Class.extend({\n    options: {\n      geocodeUrl: 'http://geocoder.api.here.com/6.2/geocode.json',\n      reverseGeocodeUrl: 'http://reverse.geocoder.api.here.com/6.2/reversegeocode.json',\n      app_id: '<insert your app_id here>',\n      app_code: '<insert your app_code here>',\n      geocodingQueryParams: {},\n      reverseQueryParams: {}\n    },\n\n    initialize: function(options) {\n      L.setOptions(this, options);\n    },\n\n    geocode: function(query, cb, context) {\n      var params = {\n        searchtext: query,\n        gen: 9,\n        app_id: this.options.app_id,\n        app_code: this.options.app_code,\n        jsonattributes: 1\n      };\n      params = L.Util.extend(params, this.options.geocodingQueryParams);\n      this.getJSON(this.options.geocodeUrl, params, cb, context);\n    },\n\n    reverse: function(location, scale, cb, context) {\n      var params = {\n        prox: encodeURIComponent(location.lat) + ',' + encodeURIComponent(location.lng),\n        mode: 'retrieveAddresses',\n        app_id: this.options.app_id,\n        app_code: this.options.app_code,\n        gen: 9,\n        jsonattributes: 1\n      };\n      params = L.Util.extend(params, this.options.reverseQueryParams);\n      this.getJSON(this.options.reverseGeocodeUrl, params, cb, context);\n    },\n\n    getJSON: function(url, params, cb, context) {\n      getJSON(url, params, function(data) {\n        var results = [],\n          loc,\n          latLng,\n          latLngBounds;\n        if (data.response.view && data.response.view.length) {\n          for (var i = 0; i <= data.response.view[0].result.length - 1; i++) {\n            loc = data.response.view[0].result[i].location;\n            latLng = L.latLng(loc.displayPosition.latitude, loc.displayPosition.longitude);\n            latLngBounds = L.latLngBounds(\n              L.latLng(loc.mapView.topLeft.latitude, loc.mapView.topLeft.longitude),\n              L.latLng(loc.mapView.bottomRight.latitude, loc.mapView.bottomRight.longitude)\n            );\n            results[i] = {\n              name: loc.address.label,\n              bbox: latLngBounds,\n              center: latLng\n            };\n          }\n        }\n        cb.call(context, results);\n      });\n    }\n  }),\n\n  factory: function(options) {\n    return new L.Control.Geocoder.HERE(options);\n  }\n};\n","import L from 'leaflet';\nimport Control from './control';\n// import Nominatim from './geocoders/nominatim';\n// import Bing from './geocoders/bing';\n// import MapQuest from './geocoders/mapquest';\n// import Mapbox from './geocoders/mapbox';\n// import What3Words from './geocoders/what3words';\n// import Google from './geocoders/google';\n// import Photon from './geocoders/photon';\n// import Mapzen from './geocoders/mapzen';\n// import ArcGis from './geocoders/arcgis';\nimport HERE from './geocoders/here';\n\nvar Geocoder = L.Util.extend(Control.class, {\n  // Nominatim: Nominatim.class,\n  // nominatim: Nominatim.factory,\n  // Bing: Bing.class,\n  // bing: Bing.factory,\n  // MapQuest: MapQuest.class,\n  // mapQuest: MapQuest.factory,\n  // Mapbox: Mapbox.class,\n  // mapbox: Mapbox.factory,\n  // What3Words: What3Words.class,\n  // what3words: What3Words.factory,\n  // Google: Google.class,\n  // google: Google.factory,\n  // Photon: Photon.class,\n  // photon: Photon.factory,\n  // Mapzen: Mapzen.class,\n  // GeocodeEarth: Mapzen.class,\n  // Pelias: Mapzen.class,\n  // mapzen: Mapzen.factory,\n  // geocodeEarth: Mapzen.factory,\n  // pelias: Mapzen.factory,\n  // ArcGis: ArcGis.class,\n  // arcgis: ArcGis.factory,\n  HERE: HERE.class,\n  here: HERE.factory\n});\n\nexport default Geocoder;\n\nL.Util.extend(L.Control, {\n  Geocoder: Geocoder,\n  geocoder: Control.factory\n});\n"],"names":["badChars","possible","escape","&","<",">","\"","'","`","escapeChar","chr","getJSON","url","params","callback","xmlHttp","XMLHttpRequest","onreadystatechange","readyState","status","JSON","parse","response","open","obj","existingUrl","uppercase","i","key","encodeURIComponent","toUpperCase","value","L","Util","isArray","j","length","push","indexOf","join","getParamString","setRequestHeader","send","template","str","data","replace","string","undefined","test","class","Class","extend","options","serviceUrl","geocodingQueryParams","reverseQueryParams","htmlTemplate","r","a","address","parts","road","building","city","town","village","hamlet","state","country","initialize","setOptions","this","geocode","query","cb","context","q","limit","format","addressdetails","bind","results","bbox","boundingbox","parseFloat","icon","name","display_name","html","latLngBounds","center","latLng","lat","lon","properties","call","reverse","location","scale","lng","zoom","Math","round","log","loc","result","bounds","factory","Control","Geocoder","Nominatim","showResultIcons","collapsed","expand","position","placeholder","errorMessage","queryMinLength","suggestMinLength","suggestTimeout","defaultMarkGeocode","includes","Evented","prototype","Mixin","Events","geocoder","_requestCount","onAdd","map","input","className","container","DomUtil","create","form","_form","_map","_container","innerHTML","type","_input","DomEvent","disableClickPropagation","_errorElement","_alts","addListener","_keydown","suggest","_change","_preventBlurCollapse","_collapse","e","button","detail","_toggle","Browser","touch","preventDefault","stopPropagation","_expand","on","_geocode","markGeocode","addClass","removeClass","_geocodeResult","_results","appendChild","_createAlt","_geocodeResultSelected","fitBounds","_geocodeMarker","removeLayer","Marker","bindPopup","addTo","openPopup","requestCount","mode","eventData","_lastGeocode","_clearResults","fire","hasClass","select","blur","_selection","index","li","text","document","createTextNode","src","setAttribute","stop","_this","dir","keyCode","parseInt","getAttribute","v","clearTimeout","_suggestTimeout","setTimeout","geocodeUrl","reverseGeocodeUrl","app_id","app_code","searchtext","gen","jsonattributes","prox","view","displayPosition","latitude","longitude","mapView","topLeft","bottomRight","label","HERE","here"],"mappings":";;;;;;;;kJAKA,IAAIA,EAAW,YACXC,EAAW,WACXC,EAAS,CACXC,IAAK,QACLC,IAAK,OACLC,IAAK,OACLC,IAAK,SACLC,IAAK,SACLC,IAAK,UAGP,SAASC,EAAWC,GAClB,OAAOR,EAAOQ,GAgCT,SAASC,EAAQC,EAAKC,EAAQC,GACnC,IAAIC,EAAU,IAAIC,eAClBD,EAAQE,mBAAqB,WACA,IAAvBF,EAAQG,aAGW,MAAnBH,EAAQI,QAAqC,MAAnBJ,EAAQI,OAItCL,EAASM,KAAKC,MAAMN,EAAQO,WAH1BR,EAAS,MAKbC,EAAQQ,KAAK,MAAOX,EAiBf,SAAwBY,EAAKC,EAAaC,GAC/C,IAAIb,EAAS,GACb,IAAK,IAAIc,KAAKH,EAAK,CACjB,IAAII,EAAMC,mBAAmBH,EAAYC,EAAEG,cAAgBH,GACvDI,EAAQP,EAAIG,GAChB,GAAKK,EAAEC,KAAKC,QAAQH,GAGlB,IAAK,IAAII,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAChCtB,EAAOwB,KAAKT,EAAM,IAAMC,mBAAmBE,EAAMI,UAHnDtB,EAAOwB,KAAKT,EAAM,IAAMC,mBAAmBE,IAO/C,OAASN,IAA6C,IAA9BA,EAAYa,QAAQ,KAAoB,IAAN,KAAazB,EAAO0B,KAAK,KA9BzDC,CAAe3B,IAAS,GAClDE,EAAQ0B,iBAAiB,SAAU,oBACnC1B,EAAQ2B,KAAK,MAGR,SAASC,EAASC,EAAKC,GAC5B,OAAOD,EAAIE,QAAQ,oBAAqB,SAASF,EAAKhB,GACpD,IAhDuBmB,EAgDnBhB,EAAQc,EAAKjB,GAMjB,YALcoB,IAAVjB,EACFA,EAAQ,GACkB,mBAAVA,IAChBA,EAAQA,EAAMc,IAnDJ,OADWE,EAsDLhB,GApDX,GACGgB,GAOZA,EAAS,GAAKA,EAET9C,EAASgD,KAAKF,GAGZA,EAAOD,QAAQ9C,EAAUS,GAFvBsC,GATAA,EAAS,WCrBL,CACbG,MAAOlB,EAAEmB,MAAMC,OAAO,CACpBC,QAAS,CACPC,WAAY,uCACZC,qBAAsB,GACtBC,mBAAoB,GACpBC,aAAc,SAASC,GACrB,IAAIC,EAAID,EAAEE,QACRC,EAAQ,GAqBV,OApBIF,EAAEG,MAAQH,EAAEI,WACdF,EAAMxB,KAAK,qCAGTsB,EAAEK,MAAQL,EAAEM,MAAQN,EAAEO,SAAWP,EAAEQ,SACrCN,EAAMxB,KACJ,iBACkB,EAAfwB,EAAMzB,OAAa,0CAA4C,IAChE,yDAIFuB,EAAES,OAAST,EAAEU,UACfR,EAAMxB,KACJ,iBACkB,EAAfwB,EAAMzB,OAAa,2CAA6C,IACjE,8BAICO,EAASkB,EAAMtB,KAAK,SAAUoB,KAIzCW,WAAY,SAASjB,GACnBrB,EAAEC,KAAKsC,WAAWC,KAAMnB,IAG1BoB,QAAS,SAASC,EAAOC,EAAIC,GAC3BjE,EACE6D,KAAKnB,QAAQC,WAAa,SAC1BtB,EAAEoB,OACA,CACEyB,EAAGH,EACHI,MAAO,EACPC,OAAQ,OACRC,eAAgB,GAElBR,KAAKnB,QAAQE,sBAEfvB,EAAEiD,KAAK,SAASpC,GAEd,IADA,IAAIqC,EAAU,GACLvD,EAAIkB,EAAKT,OAAS,EAAQ,GAALT,EAAQA,IAAK,CAEzC,IADA,IAAIwD,EAAOtC,EAAKlB,GAAGyD,YACVjD,EAAI,EAAGA,EAAI,EAAGA,IAAKgD,EAAKhD,GAAKkD,WAAWF,EAAKhD,IACtD+C,EAAQvD,GAAK,CACX2D,KAAMzC,EAAKlB,GAAG2D,KACdC,KAAM1C,EAAKlB,GAAG6D,aACdC,KAAMjB,KAAKnB,QAAQI,aAAee,KAAKnB,QAAQI,aAAaZ,EAAKlB,SAAMqB,EACvEmC,KAAMnD,EAAE0D,aAAa,CAACP,EAAK,GAAIA,EAAK,IAAK,CAACA,EAAK,GAAIA,EAAK,KACxDQ,OAAQ3D,EAAE4D,OAAO/C,EAAKlB,GAAGkE,IAAKhD,EAAKlB,GAAGmE,KACtCC,WAAYlD,EAAKlB,IAGrBgD,EAAGqB,KAAKpB,EAASM,IAChBV,QAIPyB,QAAS,SAASC,EAAUC,EAAOxB,EAAIC,GACrCjE,EACE6D,KAAKnB,QAAQC,WAAa,UAC1BtB,EAAEoB,OACA,CACEyC,IAAKK,EAASL,IACdC,IAAKI,EAASE,IACdC,KAAMC,KAAKC,MAAMD,KAAKE,IAAIL,EAAQ,KAAOG,KAAKE,IAAI,IAClDxB,eAAgB,EAChBD,OAAQ,QAEVP,KAAKnB,QAAQG,oBAEfxB,EAAEiD,KAAK,SAASpC,GACd,IACE4D,EADEC,EAAS,GAGT7D,GAAQA,EAAKgD,KAAOhD,EAAKiD,MAC3BW,EAAMzE,EAAE4D,OAAO/C,EAAKgD,IAAKhD,EAAKiD,KAC9BY,EAAOrE,KAAK,CACVkD,KAAM1C,EAAK2C,aACXC,KAAMjB,KAAKnB,QAAQI,aAAee,KAAKnB,QAAQI,aAAaZ,QAAQG,EACpE2C,OAAQc,EACRE,OAAQ3E,EAAE0D,aAAae,EAAKA,GAC5BV,WAAYlD,KAIhB8B,EAAGqB,KAAKpB,EAAS8B,IAChBlC,UAKToC,QAAS,SAASvD,GAChB,OAAO,IAAIrB,EAAE6E,QAAQC,SAASC,UAAU1D,OCvG7B,CACbH,MAAOlB,EAAE6E,QAAQzD,OAAO,CACtBC,QAAS,CACP2D,iBAAiB,EACjBC,WAAW,EACXC,OAAQ,QACRC,SAAU,WACVC,YAAa,YACbC,aAAc,iBACdC,eAAgB,EAChBC,iBAAkB,EAClBC,eAAgB,IAChBC,oBAAoB,GAGtBC,SAAU1F,EAAE2F,QAAQC,WAAa5F,EAAE6F,MAAMC,OAEzCxD,WAAY,SAASjB,GACnBrB,EAAEC,KAAKsC,WAAWC,KAAMnB,GACnBmB,KAAKnB,QAAQ0E,WAChBvD,KAAKnB,QAAQ0E,SAAW,IAAIhB,EAAU7D,OAGxCsB,KAAKwD,cAAgB,GAGvBC,MAAO,SAASC,GACd,IAIEC,EAJEC,EAAY,2BACdC,EAAYrG,EAAEsG,QAAQC,OAAO,MAAOH,EAAY,gBAChD9C,EAAOtD,EAAEsG,QAAQC,OAAO,SAAUH,EAAY,QAASC,GACvDG,EAAQhE,KAAKiE,MAAQzG,EAAEsG,QAAQC,OAAO,MAAOH,EAAY,QAASC,GAgHpE,OA7GA7D,KAAKkE,KAAOR,EACZ1D,KAAKmE,WAAaN,EAElB/C,EAAKsD,UAAY,SACjBtD,EAAKuD,KAAO,UAEZV,EAAQ3D,KAAKsE,OAAS9G,EAAEsG,QAAQC,OAAO,QAAS,GAAIC,IAC9CK,KAAO,OACbV,EAAMf,YAAc5C,KAAKnB,QAAQ+D,YACjCpF,EAAE+G,SAASC,wBAAwBb,GAEnC3D,KAAKyE,cAAgBjH,EAAEsG,QAAQC,OAAO,MAAOH,EAAY,iBAAkBC,GAC3E7D,KAAKyE,cAAcL,UAAYpE,KAAKnB,QAAQgE,aAE5C7C,KAAK0E,MAAQlH,EAAEsG,QAAQC,OACrB,KACAH,EAAY,gEACZC,GAEFrG,EAAE+G,SAASC,wBAAwBxE,KAAK0E,OAExClH,EAAE+G,SAASI,YAAYhB,EAAO,UAAW3D,KAAK4E,SAAU5E,MACpDA,KAAKnB,QAAQ0E,SAASsB,SACxBrH,EAAE+G,SAASI,YAAYhB,EAAO,QAAS3D,KAAK8E,QAAS9E,MAEvDxC,EAAE+G,SAASI,YACThB,EACA,OACA,WACM3D,KAAKnB,QAAQ4D,YAAczC,KAAK+E,sBAClC/E,KAAKgF,YAEPhF,KAAK+E,sBAAuB,GAE9B/E,MAGEA,KAAKnB,QAAQ4D,UACa,UAAxBzC,KAAKnB,QAAQ6D,OACflF,EAAE+G,SAASI,YACTd,EACA,QACA,SAASoB,GACU,IAAbA,EAAEC,QAA6B,IAAbD,EAAEE,QACtBnF,KAAKoF,WAGTpF,MAEOxC,EAAE6H,QAAQC,OAAiC,UAAxBtF,KAAKnB,QAAQ6D,OACzClF,EAAE+G,SAASI,YACTd,EACA,uBACA,SAASoB,GACPjF,KAAKoF,UACLH,EAAEM,iBACFN,EAAEO,mBAEJxF,OAGFxC,EAAE+G,SAASI,YAAYd,EAAW,YAAa7D,KAAKyF,QAASzF,MAC7DxC,EAAE+G,SAASI,YAAYd,EAAW,WAAY7D,KAAKgF,UAAWhF,MAC9DA,KAAKkE,KAAKwB,GAAG,YAAa1F,KAAKgF,UAAWhF,QAG5CA,KAAKyF,UACDjI,EAAE6H,QAAQC,MACZ9H,EAAE+G,SAASI,YACTd,EACA,aACA,WACE7D,KAAK2F,YAEP3F,MAGFxC,EAAE+G,SAASI,YACTd,EACA,QACA,WACE7D,KAAK2F,YAEP3F,OAKFA,KAAKnB,QAAQoE,oBACfjD,KAAK0F,GAAG,cAAe1F,KAAK4F,YAAa5F,MAG3CA,KAAK0F,GACH,eACA,WACElI,EAAEsG,QAAQ+B,SAAS7F,KAAKmE,WAAY,sCAEtCnE,MAEFA,KAAK0F,GACH,gBACA,WACElI,EAAEsG,QAAQgC,YAAY9F,KAAKmE,WAAY,sCAEzCnE,MAGFxC,EAAE+G,SAASC,wBAAwBX,GAE5BA,GAGTkC,eAAgB,SAASrF,EAASmE,GAChC,GAAKA,GAA8B,IAAnBnE,EAAQ9C,OAEjB,GAAqB,EAAjB8C,EAAQ9C,OAAY,CAC7BoC,KAAK0E,MAAMN,UAAY,GACvBpE,KAAKgG,SAAWtF,EAChBlD,EAAEsG,QAAQgC,YAAY9F,KAAK0E,MAAO,mDAClC,IAAK,IAAIvH,EAAI,EAAGA,EAAIuD,EAAQ9C,OAAQT,IAClC6C,KAAK0E,MAAMuB,YAAYjG,KAAKkG,WAAWxF,EAAQvD,GAAIA,SAGrDK,EAAEsG,QAAQ+B,SAAS7F,KAAKyE,cAAe,uCATvCzE,KAAKmG,uBAAuBzF,EAAQ,KAaxCkF,YAAa,SAAS1D,GAcpB,OAbAA,EAASA,EAAOjC,SAAWiC,EAE3BlC,KAAKkE,KAAKkC,UAAUlE,EAAOvB,MAEvBX,KAAKqG,gBACPrG,KAAKkE,KAAKoC,YAAYtG,KAAKqG,gBAG7BrG,KAAKqG,eAAiB,IAAI7I,EAAE+I,OAAOrE,EAAOf,QACvCqF,UAAUtE,EAAOjB,MAAQiB,EAAOnB,MAChC0F,MAAMzG,KAAKkE,MACXwC,YAEI1G,MAGT2F,SAAU,SAASd,GACjB,IAAItH,EAAQyC,KAAKsE,OAAO/G,MACxB,GAAKsH,KAAWtH,EAAMK,OAASoC,KAAKnB,QAAQiE,gBAA5C,CAIA,IAAI6D,IAAiB3G,KAAKwD,cACxBoD,EAAO/B,EAAU,UAAY,UAC7BgC,EAAY,CAAElD,MAAOpG,GAEvByC,KAAK8G,aAAevJ,EACfsH,GACH7E,KAAK+G,gBAGP/G,KAAKgH,KAAK,QAAUJ,EAAMC,GAC1B7G,KAAKnB,QAAQ0E,SAASqD,GACpBrJ,EACA,SAASmD,GACHiG,IAAiB3G,KAAKwD,gBACxBqD,EAAUnG,QAAUA,EACpBV,KAAKgH,KAAK,SAAWJ,EAAMC,GAC3B7G,KAAK+F,eAAerF,EAASmE,KAGjC7E,QAIJmG,uBAAwB,SAASjE,GAC/BlC,KAAKgH,KAAK,cAAe,CAAE/G,QAASiC,KAGtCkD,QAAS,WACH5H,EAAEsG,QAAQmD,SAASjH,KAAKmE,WAAY,qCACtCnE,KAAKgF,YAELhF,KAAKyF,WAITA,QAAS,WACPjI,EAAEsG,QAAQ+B,SAAS7F,KAAKmE,WAAY,qCACpCnE,KAAKsE,OAAO4C,SACZlH,KAAKgH,KAAK,WAGZhC,UAAW,WACTxH,EAAEsG,QAAQgC,YAAY9F,KAAKmE,WAAY,qCACvC3G,EAAEsG,QAAQ+B,SAAS7F,KAAK0E,MAAO,mDAC/BlH,EAAEsG,QAAQgC,YAAY9F,KAAKyE,cAAe,kCAC1CzE,KAAKsE,OAAO6C,OACZnH,KAAKgH,KAAK,aAGZD,cAAe,WACbvJ,EAAEsG,QAAQ+B,SAAS7F,KAAK0E,MAAO,mDAC/B1E,KAAKoH,WAAa,KAClB5J,EAAEsG,QAAQgC,YAAY9F,KAAKyE,cAAe,mCAG5CyB,WAAY,SAAShE,EAAQmF,GAC3B,IAAIC,EAAK9J,EAAEsG,QAAQC,OAAO,KAAM,IAC9B5E,EAAI3B,EAAEsG,QAAQC,OAAO,IAAK,GAAIuD,GAC9BxG,EAAOd,KAAKnB,QAAQ2D,iBAAmBN,EAAOpB,KAAOtD,EAAEsG,QAAQC,OAAO,MAAO,GAAI5E,GAAK,KACtFoI,EAAOrF,EAAOjB,UAAOzC,EAAYgJ,SAASC,eAAevF,EAAOnB,MAyClE,OAjBID,IACFA,EAAK4G,IAAMxF,EAAOpB,MAGpBwG,EAAGK,aAAa,oBAAqBN,GAEjCnF,EAAOjB,KACT9B,EAAEiF,UAAYjF,EAAEiF,UAAYlC,EAAOjB,KAEnC9B,EAAE8G,YAAYsB,GAMhB/J,EAAE+G,SAASI,YAAY2C,EAAI,uBAtCN,SAA0BrC,GAM3CjF,KAAK+E,sBAAuB,EAC5BvH,EAAE+G,SAASqD,KAAK3C,GAChBjF,KAAKmG,uBAAuBjE,GAC5B1E,EAAE+G,SAASmB,GACT4B,EACA,QACA,WACMtH,KAAKnB,QAAQ4D,UACfzC,KAAKgF,YAELhF,KAAK+G,iBAGT/G,OAmB+DA,MAE9DsH,GAGT1C,SAAU,SAASK,GACjB,IAAI4C,EAAQ7H,KACVkH,EAAS,SAAgBY,GACnBD,EAAMT,aACR5J,EAAEsG,QAAQgC,YAAY+B,EAAMT,WAAY,qCACxCS,EAAMT,WAAaS,EAAMT,WAAiB,EAANU,EAAU,cAAgB,oBAE3DD,EAAMT,aACTS,EAAMT,WAAaS,EAAMnD,MAAY,EAANoD,EAAU,aAAe,cAGtDD,EAAMT,YACR5J,EAAEsG,QAAQ+B,SAASgC,EAAMT,WAAY,sCAI3C,OAAQnC,EAAE8C,SAER,KAAK,GACC/H,KAAKnB,QAAQ4D,WACfzC,KAAKgF,YAEP,MAEF,KAAK,GACHkC,GAAQ,GACR,MAEF,KAAK,GACHA,EAAO,GACP,MAEF,KAAK,GACH,GAAIlH,KAAKoH,WAAY,CACnB,IAAIC,EAAQW,SAAShI,KAAKoH,WAAWa,aAAa,qBAAsB,IACxEjI,KAAKmG,uBAAuBnG,KAAKgG,SAASqB,IAC1CrH,KAAK+G,qBAEL/G,KAAK2F,WAEP,MACF,QACE,OAGJnI,EAAE+G,SAASgB,eAAeN,IAE5BH,QAAS,WACP,IAAIoD,EAAIlI,KAAKsE,OAAO/G,MAChB2K,IAAMlI,KAAK8G,eACbqB,aAAanI,KAAKoI,iBACdF,EAAEtK,QAAUoC,KAAKnB,QAAQkE,iBAC3B/C,KAAKoI,gBAAkBC,WACrB7K,EAAEiD,KAAK,WACLT,KAAK2F,UAAS,IACb3F,MACHA,KAAKnB,QAAQmE,gBAGfhD,KAAK+G,oBAKb3E,QAAS,SAASvD,GAChB,OAAO,IAAIrB,EAAE6E,QAAQC,SAASzD,OC/VnB,CACbH,MAAOlB,EAAEmB,MAAMC,OAAO,CACpBC,QAAS,CACPyJ,WAAY,gDACZC,kBAAmB,+DACnBC,OAAQ,4BACRC,SAAU,8BACV1J,qBAAsB,GACtBC,mBAAoB,IAGtBc,WAAY,SAASjB,GACnBrB,EAAEuC,WAAWC,KAAMnB,IAGrBoB,QAAS,SAASC,EAAOC,EAAIC,GAC3B,IAAI/D,EAAS,CACXqM,WAAYxI,EACZyI,IAAK,EACLH,OAAQxI,KAAKnB,QAAQ2J,OACrBC,SAAUzI,KAAKnB,QAAQ4J,SACvBG,eAAgB,GAElBvM,EAASmB,EAAEC,KAAKmB,OAAOvC,EAAQ2D,KAAKnB,QAAQE,sBAC5CiB,KAAK7D,QAAQ6D,KAAKnB,QAAQyJ,WAAYjM,EAAQ8D,EAAIC,IAGpDqB,QAAS,SAASC,EAAUC,EAAOxB,EAAIC,GACrC,IAAI/D,EAAS,CACXwM,KAAMxL,mBAAmBqE,EAASL,KAAO,IAAMhE,mBAAmBqE,EAASE,KAC3EgF,KAAM,oBACN4B,OAAQxI,KAAKnB,QAAQ2J,OACrBC,SAAUzI,KAAKnB,QAAQ4J,SACvBE,IAAK,EACLC,eAAgB,GAElBvM,EAASmB,EAAEC,KAAKmB,OAAOvC,EAAQ2D,KAAKnB,QAAQG,oBAC5CgB,KAAK7D,QAAQ6D,KAAKnB,QAAQ0J,kBAAmBlM,EAAQ8D,EAAIC,IAG3DjE,QAAS,SAASC,EAAKC,EAAQ8D,EAAIC,GACjCjE,EAAQC,EAAKC,EAAQ,SAASgC,GAC5B,IACE4D,EACAb,EACAF,EAHER,EAAU,GAId,GAAIrC,EAAKvB,SAASgM,MAAQzK,EAAKvB,SAASgM,KAAKlL,OAC3C,IAAK,IAAIT,EAAI,EAAGA,GAAKkB,EAAKvB,SAASgM,KAAK,GAAG5G,OAAOtE,OAAS,EAAGT,IAC5D8E,EAAM5D,EAAKvB,SAASgM,KAAK,GAAG5G,OAAO/E,GAAGuE,SACtCN,EAAS5D,EAAE4D,OAAOa,EAAI8G,gBAAgBC,SAAU/G,EAAI8G,gBAAgBE,WACpE/H,EAAe1D,EAAE0D,aACf1D,EAAE4D,OAAOa,EAAIiH,QAAQC,QAAQH,SAAU/G,EAAIiH,QAAQC,QAAQF,WAC3DzL,EAAE4D,OAAOa,EAAIiH,QAAQE,YAAYJ,SAAU/G,EAAIiH,QAAQE,YAAYH,YAErEvI,EAAQvD,GAAK,CACX4D,KAAMkB,EAAI7C,QAAQiK,MAClB1I,KAAMO,EACNC,OAAQC,GAIdjB,EAAGqB,KAAKpB,EAASM,QAKvB0B,QAAS,SAASvD,GAChB,OAAO,IAAIrB,EAAE6E,QAAQC,SAASgH,KAAKzK,KCzDnCyD,EAAW9E,EAAEC,KAAKmB,OAAOyD,EAAQ3D,MAAO,CAuB1C4K,KAAMA,EAAK5K,MACX6K,KAAMD,EAAKlH,iBAKb5E,EAAEC,KAAKmB,OAAOpB,EAAE6E,QAAS,CACvBC,SAAUA,EACViB,SAAUlB,EAAQD"}