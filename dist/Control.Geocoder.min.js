/* @preserve
 * Leaflet Control Geocoder 1.6.0
 * https://github.com/perliedman/leaflet-control-geocoder
 *
 * Copyright (c) 2012 sa3m (https://github.com/sa3m)
 * Copyright (c) 2018 Per Liedman
 * All rights reserved.
 */
this.L=this.L||{},this.L.Control=this.L.Control||{},this.L.Control.Geocoder=function(a){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a;var n=/[&<>"'`]/g,r=/[&<>"'`]/,t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function l(e){return t[e]}function o(e,t,o){var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&(200===s.status||304===s.status?o(JSON.parse(s.response)):o(""))},s.open("GET",e+function(e,t,o){var s=[];for(var i in e){var n=encodeURIComponent(o?i.toUpperCase():i),r=e[i];if(a.Util.isArray(r))for(var l=0;l<r.length;l++)s.push(n+"="+encodeURIComponent(r[l]));else s.push(n+"="+encodeURIComponent(r))}return(t&&-1!==t.indexOf("?")?"&":"?")+s.join("&")}(t),!0),s.setRequestHeader("Accept","application/json"),s.send(null)}function s(e,i){return e.replace(/\{ *([\w_]+) *\}/g,function(e,t){var o,s=i[t];return void 0===s?s="":"function"==typeof s&&(s=s(i)),null==(o=s)?"":o?(o=""+o,r.test(o)?o.replace(n,l):o):o+""})}var i={class:a.Class.extend({options:{serviceUrl:"https://nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(e){var t=e.address,o=[];return(t.road||t.building)&&o.push("{building} {road} {house_number}"),(t.city||t.town||t.village||t.hamlet)&&o.push('<span class="'+(0<o.length?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>'),(t.state||t.country)&&o.push('<span class="'+(0<o.length?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),s(o.join("<br/>"),t)}},initialize:function(e){a.Util.setOptions(this,e)},geocode:function(e,n,r){o(this.options.serviceUrl+"search",a.extend({q:e,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),a.bind(function(e){for(var t=[],o=e.length-1;0<=o;o--){for(var s=e[o].boundingbox,i=0;i<4;i++)s[i]=parseFloat(s[i]);t[o]={icon:e[o].icon,name:e[o].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e[o]):void 0,bbox:a.latLngBounds([s[0],s[2]],[s[1],s[3]]),center:a.latLng(e[o].lat,e[o].lon),properties:e[o]}}n.call(r,t)},this))},reverse:function(e,t,s,i){o(this.options.serviceUrl+"reverse",a.extend({lat:e.lat,lon:e.lng,zoom:Math.round(Math.log(t/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),a.bind(function(e){var t,o=[];e&&e.lat&&e.lon&&(t=a.latLng(e.lat,e.lon),o.push({name:e.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e):void 0,center:t,bounds:a.latLngBounds(t,t),properties:e})),s.call(i,o)},this))}}),factory:function(e){return new a.Control.Geocoder.Nominatim(e)}},e={class:a.Control.extend({options:{showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},includes:a.Evented.prototype||a.Mixin.Events,initialize:function(e){a.Util.setOptions(this,e),this.options.geocoder||(this.options.geocoder=new i.class),this._requestCount=0},onAdd:function(e){var t,o="leaflet-control-geocoder",s=a.DomUtil.create("div",o+" leaflet-bar"),i=a.DomUtil.create("button",o+"-icon",s),n=this._form=a.DomUtil.create("div",o+"-form",s);return this._map=e,this._container=s,i.innerHTML="&nbsp;",i.type="button",(t=this._input=a.DomUtil.create("input","",n)).type="text",t.placeholder=this.options.placeholder,a.DomEvent.disableClickPropagation(t),this._errorElement=a.DomUtil.create("div",o+"-form-no-error",s),this._errorElement.innerHTML=this.options.errorMessage,this._alts=a.DomUtil.create("ul",o+"-alternatives leaflet-control-geocoder-alternatives-minimized",s),a.DomEvent.disableClickPropagation(this._alts),a.DomEvent.addListener(t,"keydown",this._keydown,this),this.options.geocoder.suggest&&a.DomEvent.addListener(t,"input",this._change,this),a.DomEvent.addListener(t,"blur",function(){this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1},this),this.options.collapsed?"click"===this.options.expand?a.DomEvent.addListener(s,"click",function(e){0===e.button&&2!==e.detail&&this._toggle()},this):a.Browser.touch&&"touch"===this.options.expand?a.DomEvent.addListener(s,"touchstart mousedown",function(e){this._toggle(),e.preventDefault(),e.stopPropagation()},this):(a.DomEvent.addListener(s,"mouseover",this._expand,this),a.DomEvent.addListener(s,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),a.Browser.touch?a.DomEvent.addListener(s,"touchstart",function(){this._geocode()},this):a.DomEvent.addListener(s,"click",function(){this._geocode()},this)),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",function(){a.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")},this),this.on("finishgeocode",function(){a.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")},this),a.DomEvent.disableClickPropagation(s),s},_geocodeResult:function(e,t){if(t||1!==e.length)if(0<e.length){this._alts.innerHTML="",this._results=e,a.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");for(var o=0;o<e.length;o++)this._alts.appendChild(this._createAlt(e[o],o))}else a.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error");else this._geocodeResultSelected(e[0])},markGeocode:function(e){return e=e.geocode||e,this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new a.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this},_geocode:function(t){var e=this._input.value;if(t||!(e.length<this.options.queryMinLength)){var o=++this._requestCount,s=t?"suggest":"geocode",i={input:e};this._lastGeocode=e,t||this._clearResults(),this.fire("start"+s,i),this.options.geocoder[s](e,function(e){o===this._requestCount&&(i.results=e,this.fire("finish"+s,i),this._geocodeResult(e,t))},this)}},_geocodeResultSelected:function(e){this.fire("markgeocode",{geocode:e})},_toggle:function(){a.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()},_expand:function(){a.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")},_collapse:function(){a.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),a.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),a.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),this._input.blur(),this.fire("collapse")},_clearResults:function(){a.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,a.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_createAlt:function(t,e){var o=a.DomUtil.create("li",""),s=a.DomUtil.create("a","",o),i=this.options.showResultIcons&&t.icon?a.DomUtil.create("img","",s):null,n=t.html?void 0:document.createTextNode(t.name);return i&&(i.src=t.icon),o.setAttribute("data-result-index",e),t.html?s.innerHTML=s.innerHTML+t.html:s.appendChild(n),a.DomEvent.addListener(o,"mousedown touchstart",function(e){this._preventBlurCollapse=!0,a.DomEvent.stop(e),this._geocodeResultSelected(t),a.DomEvent.on(o,"click",function(){this.options.collapsed?this._collapse():this._clearResults()},this)},this),o},_keydown:function(e){var t=this,o=function(e){t._selection&&(a.DomUtil.removeClass(t._selection,"leaflet-control-geocoder-selected"),t._selection=t._selection[0<e?"nextSibling":"previousSibling"]),t._selection||(t._selection=t._alts[0<e?"firstChild":"lastChild"]),t._selection&&a.DomUtil.addClass(t._selection,"leaflet-control-geocoder-selected")};switch(e.keyCode){case 27:this.options.collapsed&&this._collapse();break;case 38:o(-1);break;case 40:o(1);break;case 13:if(this._selection){var s=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[s]),this._clearResults()}else this._geocode();break;default:return}a.DomEvent.preventDefault(e)},_change:function(){var e=this._input.value;e!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),e.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(a.bind(function(){this._geocode(!0)},this),this.options.suggestTimeout):this._clearResults())}}),factory:function(e){return new a.Control.Geocoder(e)}},c={class:a.Class.extend({options:{geocodeUrl:"http://geocoder.api.here.com/6.2/geocode.json",reverseGeocodeUrl:"http://reverse.geocoder.api.here.com/6.2/reversegeocode.json",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(e){a.setOptions(this,e)},geocode:function(e,t,o){var s={searchtext:e,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1};s=a.Util.extend(s,this.options.geocodingQueryParams),this.getJSON(this.options.geocodeUrl,s,t,o)},reverse:function(e,t,o,s){var i={prox:encodeURIComponent(e.lat)+","+encodeURIComponent(e.lng),mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1};i=a.Util.extend(i,this.options.reverseQueryParams),this.getJSON(this.options.reverseGeocodeUrl,i,o,s)},getJSON:function(e,t,r,l){o(e,t,function(e){var t,o,s,i=[];if(e.response.view&&e.response.view.length)for(var n=0;n<=e.response.view[0].result.length-1;n++)t=e.response.view[0].result[n].location,o=a.latLng(t.displayPosition.latitude,t.displayPosition.longitude),s=a.latLngBounds(a.latLng(t.mapView.topLeft.latitude,t.mapView.topLeft.longitude),a.latLng(t.mapView.bottomRight.latitude,t.mapView.bottomRight.longitude)),i[n]={name:t.address.label,bbox:s,center:o};r.call(l,i)})}}),factory:function(e){return new a.Control.Geocoder.HERE(e)}},d=a.Util.extend(e.class,{HERE:c.class,here:c.factory});return a.Util.extend(a.Control,{Geocoder:d,geocoder:e.factory}),d}(L);
//# sourceMappingURL=Control.Geocoder.min.js.map
